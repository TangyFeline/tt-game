<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.9.0/vis.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.9.0/vis.min.css">

    <style type="text/css">
        #mynetwork {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
        }
    </style>


</head>
<p>@Ajax.ActionLink("View Diagram", "Diagram", "QuestWriter", new { Id = ViewBag.QuestId }, new AjaxOptions { UpdateTargetId = "swapMe", InsertionMode = InsertionMode.Replace, HttpMethod = "GET", OnSuccess = "success", OnFailure = "fail", OnBegin = "waiting" }, new { @class = "" })</p>
<h1>Diagram</h1>

<div id="mynetwork" width="100%" height="100%"></div>



<script>
    var questId = @ViewBag.QuestId;


    var states = [];
    var connections = [];

    var done = 0;

    function loadStates() {
        $.getJSON("/QuestWriter/DiagramStatesJSON/" + questId, function (data) {
            states = data;
        }).then(function () {
            done++;

            if (done == 2) {
                renderDiagram();
            }
        });
    }

    function loadConnections() {
        $.getJSON("/QuestWriter/DiagramConnectionsJSON/" + questId, function (data) {
            connections = data;
        }).then(function () {
            done++;
            if (done == 2) {
                renderDiagram();
            }
        });
    }

    loadStates();
    loadConnections();

    function renderDiagram() {
       // console.log(states);
       
        var nodesRaw = [];
        for (var i = 0; i < states.length; i++) {
            var state = states[i];
            var node = {
                id: state.Id,
                label: state.StateName,
            }
            nodesRaw.push(node);
        }

        var nodes = new vis.DataSet(nodesRaw);

        var edgesRaw = [];
        for (var i = 0; i < connections.length; i++) {
            var connection = connections[i];
            var edge = {
                from: connection.From,
                to: connection.To,
                label: connection.Name,
            }
            edgesRaw.push(edge);
        }

        var edges = new vis.DataSet(edgesRaw);

        // create a network
        var container = document.getElementById('mynetwork');

        // provide the data in the vis format
        var data = {
            nodes: nodes,
            edges: edges
        };

        var options = {
            autoResize: true,
            height: '100%',
            width: '100%',
            locale: 'en'
        };

        // initialize your network!
        var network = new vis.Network(container, data, options);


    }



</script>