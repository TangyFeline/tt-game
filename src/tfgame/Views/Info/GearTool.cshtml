<head>
    <script src="~/Scripts/jquery-ui-1.10.4.js"></script>
</head>

<h1>Updated Oct 5, 2015</h1>

<div id="toggles">
    @*<input type="checkbox" id="nonstandard" value="nonstandard"> Nonstandard 	&nbsp;*@
    <input type="checkbox" id="accessory" value="accessory" checked> Accessory 	&nbsp;
    <input type="checkbox" id="consumable" value="consumable" checked> Consumable 	&nbsp;
    <input type="checkbox" id="consumable_reuseable" value="consumable_reuseable" checked> Reusable Consumable 	&nbsp;
    <input type="checkbox" id="hat" value="hat" checked> Hat 	&nbsp;
    <input type="checkbox" id="pants" value="pants" checked> Pants 	&nbsp;
    <input type="checkbox" id="pet" value="pet" checked> Pet 	&nbsp;
    <input type="checkbox" id="shirt" value="shirt" checked> Shirt 	&nbsp;
    <input type="checkbox" id="shoes" value="shoes" checked> Shoes 	&nbsp;
    <input type="checkbox" id="underpants" value="underpants" checked> Underpants 	&nbsp;
    <input type="checkbox" id="undershirt" value="undershirt" checked> Undershirt 	&nbsp;
</div>
<input type="checkbox" id="deselectAll" value="deselectAll"> [Unselect All] 	&nbsp;


<div style="overflow-x: scroll;">
    <table id="itemTable">


        <thead>
            <tr>
                <th>Graphic</th>
                <th>Name</th>
                <th>Item Type</th>
                <th>Discipline</th>
                <th>Perception</th>
                <th>Charisma</th>
                <th>Fortitude</th>
                <th>Agility</th>
                <th>Restoration</th>
                <th>Magicka</th>
                <th>Regeneration</th>
                <th>Luck</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>




    </table>
</div>

<script>

    var itemsUnfiltered = [];
    var items = [];
    var datatableObj = "";

    // populate the the jump to dropdown with all states found for the current quest
    function loadJson() {
        $.getJSON("/Content/JSON/items.json", function (data) {
            itemsUnfiltered = data;
        }).then(function () {
            filterData();
            
        }).fail(function () {
            alert("Failed to load json");
        });
    }

    function filterData() {

        items = [];

        for (var i = 0; i < itemsUnfiltered.length; i++) {

            var item = itemsUnfiltered[i];

            var id = "#" + item.ItemType;
            var isSelected = $(id).is(':checked');

            if (isSelected == true) {
                items.push(item);
            }

        }

        renderTable();

    }

    function renderTable() {

        var table = $('#itemTable');
        $("#tbody").empty();

        for (var i = 0; i < items.length; i++) {

            var dat = items[i];
   
            var img = "<td>" + printPortrait(dat) + "</td>";
            var friendlyName = "<td>" + dat.FriendlyName + "</td>";
            var type = "<td>" + dat.ItemType + "</td>";

            var disc = "<td>" + styleMe(dat.Discipline) + "</td>";
            var perc = "<td>" + styleMe(dat.Perception) + "</td>";
            var char = "<td>" + styleMe(dat.Charisma) + "</td>";
            var fort = "<td>" + styleMe(dat.Fortitude) + "</td>";
            var agil = "<td>" + styleMe(dat.Agility) + "</td>";
            var rest = "<td>" + styleMe(dat.Allure) + "</td>";
            var mag = "<td>" + styleMe(dat.Magicka) + "</td>";
            var regen = "<td>" + styleMe(dat.Succour) + "</td>";
            var luck = "<td>" + styleMe(dat.Luck) + "</td>";


            table.append('<tr>' +

                img +
                friendlyName +
                type +

                disc +
                perc +
                char +
                fort +
                agil +
                rest +
                mag +
                regen +
                luck +

                '</tr>');
        }

        datatableObj = $('#itemTable').dataTable({
            "lengthMenu": [[10, 25, 50, 100, 200, -1], [10, 25, 50, 100, 200, "All"]],
            "bDestroy": true,
        });

    }

    function styleMe(value) {
        if (value == 0) {
            return "<span class='zero'>" + value + "</span>";
        } else if (value > 0) {
            return "<span class='good'>" + value + "</span>";
        } else {
            return "<span class='bad'>" + value + "</span>";
        }
    }



    function printPortrait(dat) {
        if (dat.ItemType == 'pet') {
            return "<img src='/Images/PvP/animalPortraits/Thumbnails/100/" + dat.PortraitUrl + "' width=50; height=50;>";
        } else {
            return "<img src='/Images/PvP/itemsPortraits/Thumbnails/100/" + dat.PortraitUrl + "' width=50; height=50;>";
        }
    }

    function refreshTable() {
        $('#itemTable').DataTable().destroy();
        filterData();
    }

    $("#toggles :input").each(function () {

        $(this).click(function () {
            refreshTable();
        });

    });

    $("#deselectAll").click(function () {
        $("#toggles :input").each(function () {
            $(this).attr('checked', false);
        });
        $(this).attr('checked', false);
        refreshTable();

    });

    loadJson();

</script>

<style>
     th, td {
        border: 1px solid black;
        text-align: center;
    }
</style>