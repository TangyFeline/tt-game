@model TT.Domain.ViewModels.SettingsPageViewModel
@using TT.Domain.Statics
@using TT.Web.CustomHtmlHelpers

<nav class="navbar navbar-default outsideContainer navbarTT2">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
            <ul class="nav navbar-nav">
                <li>@Html.ActionLink("Back to game", MVC.PvP.Play())</li>
                <li>@Html.ActionLink("My blacklist entries", MVC.Settings.MyBlacklistEntries())</li>
                <li>@Html.ActionLink("Update bio", MVC.Settings.SetBio())</li>
                <li>@Html.ActionLink("Reserve name", MVC.PvP.ReserveName())</li>
                <li>@Html.ActionLink("Rules", MVC.Info.Rules())</li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<div class="containerInner center-block">
    <h2>Offline Timer</h2>

    <p>
        Your account currently has <b>@Model.Strikes.Count()/@PvPStatics.MaxStrikesPerRound</b> strikes against it.  Read more about strikes @Html.ActionLink("here", MVC.Info.Rules(), new { target = "_blank" }).

        @{
            if (Model.Strikes.Any())
            {
                <table class="table table-hover dt-responsive messageTable">
                    <thead>
                        <tr>
                            <th>Date/Time</th>
                            <th>Reason</th>
                            <th>Round</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            foreach (var strike in Model.Strikes)
                            {
                                <tr>
                                    <td>@strike.Timestamp.ToString("MMMM dd, yyyy")</td>
                                    <td>@strike.Reason</td>
                                    <td>@strike.Round</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            }
        }

    </p>

    @{
        if (Model.TimeUntilLogout >= 60)
        {
            <p>Your character is offline.</p>
        }
        else if (Model.TimeUntilLogout > 0)
        {
            <p>You will go into offline mode in <b>@Model.TimeUntilLogout</b> minutes.</p>
        }
        else
        {
            <p><span class="good">You are offline.</span></p>
        }

        <p>You were last in combat <b>@Math.Abs(Math.Floor(Model.Player.GetLastCombatTimestamp().Subtract(DateTime.UtcNow).TotalMinutes))</b> minutes ago.</p>

        if (Model.Player.Mobility != PvPStatics.MobilityFull)
        {
            if (Model.TimeUntilReroll > 0)
            {
                <p>You can restart your character in <b>@Model.TimeUntilReroll</b> minutes.</p>
            }
            else
            {
                <p>You can restart your character <b>now</b>.</p>
            }
        }


        if (User.IsInRole(PvPStatics.Permissions_MultiAccountWhitelist))
        {
            <p class="good">You are on the multiple account whitelist.</p>
        }

        if (User.IsInRole(PvPStatics.Permissions_Moderator))
        {
            <p class="good">You are on the chat moderators list.</p>
        }

        if (User.IsInRole(PvPStatics.Permissions_Proofreader))
        {
            <p class="good">You are on the proofreaders list.</p>
        }

        if (User.IsInRole(PvPStatics.Permissions_Publisher))
        {
            <p class="good">You are on the publishers list.</p>
        }

        if (User.IsInRole(PvPStatics.Permissions_Previewer))
        {
            <p class="good">You are on the contribution previewer list. @Html.ActionLink("Preview Contributions", MVC.PvPAdmin.ApproveContributionList())<br /></p>
        }

        if (User.IsInRole(PvPStatics.Permissions_Artist))
        {
            <p class="good">
                You are on the artists list. @Html.ActionLink("Update your Artist Biography", MVC.Settings.WriteAuthorArtistBio())<br>
                @Html.ActionLink("List my artist bio", MVC.Settings.SetArtistBioVisibility(true))<br>
                @Html.ActionLink("Do not list my artist bio", MVC.Settings.SetArtistBioVisibility(false))
            </p>
        }

        if (User.IsInRole(PvPStatics.Permissions_Killswitcher))
        {
            <p class="good">You are on the update killswitch list.   <span class="bad">Activate this link when and ONLY when you and a number of animate players are receiving error screens and are unable to play.  Clicking this link will temporarily disable turn updates so bots do not attacker players who are incapable of responding.  @Html.ActionLink("CLICK HERE TO ACTIVATE.", MVC.PvPAdmin.Killswitch())</span></p>
        }

        if (User.IsInRole(PvPStatics.Permissions_QuestWriter))
        {
            <p class="good">You are on the questwriters list. @Html.ActionLink("Write Quests", MVC.QuestWriter.Index())</p>
        }

        if (User.IsInRole(PvPStatics.Permissions_Chaoslord))
        {
            <p class="good">You are on the chaoslord list.</p>
        }

    }

    <h2>View Statistics</h2>

    <p>@Html.ActionLink("View your statistics for this round", MVC.Settings.PlayerStats(Model.Player.MembershipId))</p>

    <h2>Reserve this Name</h2>
    <p>
        You can reserve your name so that no other players take it at the start of a new round and steal your identity.
        You must be level 3 or higher in order to do this.<br /><br />
        @Html.ActionLink("Reserve Name", MVC.PvP.ReserveName())<br />
        @Html.ActionLink("Use my custom starting form (if available)", MVC.Settings.UseMyCustomForm())
    </p>


    <h2>Update Your Biography</h2>

    <p>
        You can write a short bio of yourself or this player here.  You can also select RP tags which will indicate to others what your roleplaying theme intersts include or exclude.<br /><br />
        @Html.ActionLink("Update My Bio", MVC.Settings.SetBio())
    </p>


    <h2>RP Mode</h2>

    <p>
        If you choose to enter RP mode, you are publicly indicated to other players that you enjoy roleplaying.
        You can enable and disable this at any time you want.  Click on the link below to enter RP mode.<br /><br />
        @{
            if (Model.Player.InRP)
            {
                <span class="good">You have your RP flag enabled.  Click @Html.ActionLink("HERE", MVC.Settings.ChangeRPMode(false)) to turn it off.</span>
            }
            else
            {
                <span class="bad">You have your RP flag disabled.  Click @Html.ActionLink("HERE", MVC.Settings.ChangeRPMode(true)) to turn it on.</span>
            }

        }
    </p>

    @{
        if (PvPStatics.ChaosMode)
        {
            <p>
                <h4 class="bad">CHAOS MODE OPTIONS ONLY:</h4>
                @Html.ActionLink("Enter SuperProtection Mode", MVC.Settings.ChangeGameMode(GameModeStatics.SuperProtection))<br />
                @Html.ActionLink("Enter Protection Mode", MVC.Settings.ChangeGameMode(GameModeStatics.Protection))<br />
                @Html.ActionLink("Enter PvP Mode", MVC.Settings.ChangeGameMode(GameModeStatics.PvP))<br />
                @Html.ActionLink("Change back into base form", MVC.Settings.ChaosRestoreBase())<br />
                @Html.ActionLink("Reset All Quests and Abandon Current", MVC.Quest.ResetQuests())<br />
            </p>
        }
    }


    <h2>Protection Mode</h2>

    <p>
        There are three game modes:  1) Superprotection disables ALL spells from being cast against you by others players.  2) Protection.  Being in protection mode disallows other players from casting inanimate, pet, and mind control spells against you.  3) PvP mode enables all spells to be cast against you in a competative manner by other PvP players.  Friends and AI players (psychopathic spellslingers and bosses) are exempt from these rules.  Additionally, being someone's friend enables them to cast any spell against you they choose regardless of which game mode either of you are in.  <span class="bad">As of Alpha Round 19 you can no longer freely move between Protection and PvP game modes.</span><br /><br />

        @{
            if (Model.Player.GameMode == GameModeStatics.Protection)
            {
                @Html.ActionLink("Enter SuperProtection Mode", MVC.Settings.ChangeGameMode(GameModeStatics.SuperProtection))<br />
            }
            else if (Model.Player.GameMode == GameModeStatics.SuperProtection)
            {
                @Html.ActionLink("Enter Protection Mode", MVC.Settings.ChangeGameMode(GameModeStatics.Protection))<br />
            }
            else if (Model.Player.GameMode == GameModeStatics.PvP && !PvPStatics.ChaosMode)
            {
                <span class="bad">You cannot leave PvP mode in regular round gameplay.</span>
            }
        }
    </p>
    @{

        if (Model.Player.GameMode == 0 || Model.Player.GameMode == 1)
        {
            <h2>Lower your WP (Protection Mode only)</h2>

            <p>
                You can voluntarily submit to the magic of a friend (or enemy?) more quickly by voluntarily lowering your willpower to make yourself more vulnerable to attacks.<br /><br />

                @Html.ActionLink("Decrease Willpower to Half", MVC.Settings.DumpWillpower("half"))<br /><br />
                @Html.ActionLink("Decrease Willpower to Zero", MVC.Settings.DumpWillpower("full"))
            </p>

        }

    }

    <h2>Change your Chat Color</h2>

    <p>
        You can change the color that your name appears in the game's chats below.<br /><br />
        <b>
            <span style="color:black;">[] @Html.ActionLink("Black", MVC.Settings.SetChatColor("black"))</span>
            <span style="color:blueviolet !important;">[] @Html.ActionLink("Blue Violet", MVC.Settings.SetChatColor("blueviolet"))</span>
            <span style="color:cadetblue;">[] @Html.ActionLink("Cadet Blue", MVC.Settings.SetChatColor("cadetblue"))</span>
            <span style="color:darkcyan;">[] @Html.ActionLink("Dark Cyan", MVC.Settings.SetChatColor("darkcyan"))</span>
            <span style="color:darkolivegreen;">[] @Html.ActionLink("Dark Olive Green", MVC.Settings.SetChatColor("darkolivegreen"))</span><br />
            <span style="color:#A1770F;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#A1770F"))</span>
            <span style="color:green;">[] @Html.ActionLink("Green", MVC.Settings.SetChatColor("green"))</span>
            <span style="color:indigo;">[] @Html.ActionLink("Indigo", MVC.Settings.SetChatColor("indigo"))</span>
            <span style="color:lightcoral;">[] @Html.ActionLink("Light Coral", MVC.Settings.SetChatColor("lightcoral"))</span>
            <span style="color:mediumpurple;">[] @Html.ActionLink("Medium Purple", MVC.Settings.SetChatColor("mediumpurple"))</span>
            <span style="color:#C98300;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#C98300"))</span>
            <span style="color:#747474;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#747474"))</span>
            <span style="color:#5B67C5;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#5B67C5"))</span>
            <span style="color:#8B5DA2;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#8B5DA2"))</span>
            <span style="color:#DE45DC;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#DE45DC"))</span>
            <span style="color:#249B6C;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#249B6C"))</span>
            <span style="color:#337158;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#337158"))</span>
            <span style="color:#716E33;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#716E33"))</span>
            <span style="color:#986AAA;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#986AAA"))</span>
            <span style="color:#87249B;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#87249B"))</span>
            <span style="color:#4D5277;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#4D5277"))</span>
            <span style="color:#5F8DBA;">[] @Html.ActionLink("COLOR", MVC.Settings.SetChatColor("#5F8DBA"))</span>
        </b>
    </p>

    <h2>Set your Nickname (Donation Feature)</h2>
    <p>
        Players who pledge $7 monthly on Patreon (Tier 2) may create a nickname and change it at any time.  Nicknames must be 20 characters or fewer and will appear inbetween your player's first and last names.<br /><br />

        @Html.ActionLink("Set your nickname", MVC.Settings.SetNickname())<br /><br />
    </p>

    <h2>Player Blacklist</h2>
    <p>
        View and update any blacklist entries you have set. @Html.ActionLink("My Blacklist Entries", MVC.Settings.MyBlacklistEntries())
    </p>

    <h2>Audio Notifications</h2>

    <p>You can toggle audio notifications here.  Audio notifications will play short, sometimes repeating sounds when certain events happen in game.  (This does not work across all browers, particularly mobile OSes.)</p>

    <p id="toggleAudio_update"><a>Click here to toggle update audio notifications for turn updates.</a>  This will play a chiming soon when a turn has ended.</p>

    <p id="toggleAudio_attack"><a>Click here to toggle attack notifications.</a>  This will play a short when you are attacked ingame.</p>

    <p id="toggleAudio_message"><a>Click here to toggle message audio notifications.</a>  This will play a short sound when you receive a new message from another player.</p>

    <h2>Chrome/Firefox push Notifications</h2>
    <p id="togglePush"><a>Click here to toggle Chrome/Firefox push notifications.</a>  If you enable these, you will recieve HTML5 Notifications which will create small popups on your screen when you receieve a notice, even if the browsers is minimized.  You must also grant this site permission to send notifications; your browser should prompt you for permission the first time it tries to send one.</p>

</div>

<script>
    $(document).ready(function () {

        $("#toggleAudio_update").click(function () {
            var toggle = localStorage.getItem("play_updateSoundEnabled");

            if (toggle == undefined || toggle == "false") {
                var toggle = localStorage.setItem("play_updateSoundEnabled", "true");
                alert("Update audio notifications ENABLED.");
            } else {
                var toggle = localStorage.setItem("play_updateSoundEnabled", "false");
                alert("Update audio notifications DISABLED.");
            }

        });

        $("#toggleAudio_attack").click(function () {
            var toggle = localStorage.getItem("play_AttackSoundEnabled");

            if (toggle == undefined || toggle == "false") {
                var toggle = localStorage.setItem("play_AttackSoundEnabled", "true");
                alert("Attack audio notifications ENABLED.");
            } else {
                var toggle = localStorage.setItem("play_AttackSoundEnabled", "false");
                alert("Attack audio notifications DISABLED.");
            }

        });

        $("#toggleAudio_message").click(function () {
            var toggle = localStorage.getItem("play_MessageSoundEnabled");

            if (toggle == undefined || toggle == "false") {
                var toggle = localStorage.setItem("play_MessageSoundEnabled", "true");
                alert("Message audio notifications ENABLED.");
            } else {
                var toggle = localStorage.setItem("play_MessageSoundEnabled", "false");
                alert("Message audio notifications DISABLED.");
            }

        });


        $("#togglePush").click(function () {
            var toggle = localStorage.getItem("play_html5PushEnabled");

            if (toggle == undefined || toggle == "false") {
                var toggle = localStorage.setItem("play_html5PushEnabled", "true");
                alert("HTML Notifications ENABLED.");
            } else {
                var toggle = localStorage.setItem("play_html5PushEnabled", "false");
                alert("HTML Notifications DISABLED");
            }

        });

    });
</script>


<style>
    p {
        border: 1px solid;
        height: auto;
        width: 75%;
        margin-left: auto;
        margin-right: auto;
        padding: 5px;
        overflow: auto;
    }
</style>