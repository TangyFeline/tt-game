@{
    ViewBag.Title = "Chat";
}

<head>
    <link href="~/Content/PvP.css" rel="stylesheet" />
</head>

<h2>Duel</h2>


<div id="actionWindow">
    
</div>

<div id="textbox">

</div>

<p>
    @Html.ActionLink("Back to game", MVC.PvP.Play())
</p>

<style>
    #actionWindow {
        width: 700px;
        height: 700px;
        border: 1px solid black;
        background-color: lightpink;
    }
    #textbox {
        width: 700px;
        height: 200px;
        border: 1px solid black;
    }
</style>


@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.0.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>

        var actionType = 0; // 0 = move, 1 = attack
        var sendme = "";


        $(function () {
            var link = $.connection.duelHub;


            link.client.addNewMessageToPage = function (message) {
                console.log(message);
              //  var update = jQuery.parseJSON(message);
               
                $('#discussion ').prepend(message);
            };


            $.connection.hub.start().done(function () {
                link.server.joinRoom("duel");
                link.state.toRoom = "duel";


                $('#sendmessage').click(function () {
                    link.server.send($('#displayname').val(), $('#message').val());
                });


            });

            $("#actionWindow").click(function (e) {
                var posX = $(this).offset().left;
                var posY = $(this).offset().top;

                var output = "";

                if (actionType == 0) {
                    output += "move,";
                    actionType = 1;
                } else {
                    output += "attack,";
                    actionType = 0;
                }

               output += (e.pageX - posX) + ',' + (e.pageY - posY);

                link.server.send(output);

            });

        });

       



    </script>

    }

